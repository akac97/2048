window.fakeStorage={_data:{},setItem:function(b,a){return this._data[b]=String(a)},getItem:function(a){return this._data.hasOwnProperty(a)?this._data[a]:undefined},removeItem:function(a){return delete this._data[a]},clear:function(){return this._data={}}};function LocalStorageManager(){this.bestScoreKey="bestScore";this.gameStateKey="gameState";this.gameStatesStackKey="gameStatesStack";var a=this.localStorageSupported();this.storage=a?window.localStorage:window.fakeStorage}LocalStorageManager.prototype.localStorageSupported=function(){var c="test";try{var b=window.localStorage;b.setItem(c,"1");b.removeItem(c);return true}catch(a){return false}};LocalStorageManager.prototype.getBestScore=function(){return this.storage.getItem(this.bestScoreKey)||0};LocalStorageManager.prototype.setBestScore=function(a){this.storage.setItem(this.bestScoreKey,a)};LocalStorageManager.prototype.getGameState=function(){var a=this.storage.getItem(this.gameStateKey);return a?JSON.parse(a):null};LocalStorageManager.prototype.setGameState=function(a){this.storage.setItem(this.gameStateKey,JSON.stringify(a))};LocalStorageManager.prototype.clearGameState=function(){this.storage.removeItem(this.gameStateKey);this.storage.removeItem(this.gameStatesStackKey)};LocalStorageManager.prototype.popGameState=function(){var c=this.storage.getItem(this.gameStatesStackKey);var d=c?JSON.parse(c):[];var a=null;var b=this.storage.getItem(this.gameStateKey);if(d.length>0){a=d.pop();if(b.indexOf(a)>=0){a=d.pop()}}if(d.length==0){d.push(a)}this.storage.setItem(this.gameStatesStackKey,JSON.stringify(d));return a?JSON.parse(a):null};LocalStorageManager.prototype.pushGameState=function(a){var b=this.storage.getItem(this.gameStatesStackKey);var c=b?JSON.parse(b):[];if(typeof c!=="undefined"){if(c.length>50){c.shift()}}c.push(JSON.stringify(a));this.storage.setItem(this.gameStatesStackKey,JSON.stringify(c))};LocalStorageManager.prototype.getLengthOfGameStatesStack=function(){var a=this.storage.getItem(this.gameStatesStackKey);var b=a?JSON.parse(a):[];return b.length};
